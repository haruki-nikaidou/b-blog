---
import type { CollectionEntry } from "astro:content";
import "katex/dist/katex.css";
import RootLayout from "./RootLayout.astro";
import Card from "@/components/Card.astro";
import { imageDeliveryUrl } from "../utils";
import "../styles/article.scss";

type Props = CollectionEntry<"blog">["data"];

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImageId,
  heroImageSource,
  heroImageSourceUrl,
  heroImageAuthor,
  heroImageAuthorUrl,
  heroImageOwned,
  tags,
  draft,
} = Astro.props;
---

<RootLayout
  title={title}
  description={description}
  image={heroImageId ? imageDeliveryUrl(heroImageId, "small") : undefined}
>
  <Card>
    {
      heroImageId && (
        <img
          src={imageDeliveryUrl(heroImageId, "public")}
          alt={title}
          loading="lazy"
          class="hero-image"
        />
      )
    }
    <article>
      <h1 class="emphasize">
        {title}
      </h1>
      <div class="meta">
        {
          draft && (
            <p class="meta-text">
              <span class="tag">Draft</span>
            </p>
          )
        }
        <p class="meta-text">
          This article is licensed under <a
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
            >CC BY-NC-SA 4.0</a
          >.
        </p>
        {
          heroImageOwned && (
            <p class="meta-text">
              Hero image is by blog author. All rights reserved.
            </p>
          )
        }
        {
          !heroImageOwned && (
            <p class="meta-text">
              Hero image by{" "}
              {heroImageAuthorUrl ? (
                <a href={heroImageAuthorUrl}>{heroImageAuthor}</a>
              ) : (
                heroImageAuthor
              )}
              on{" "}
              {heroImageSourceUrl ? (
                <a href={heroImageSourceUrl}>{heroImageSource}</a>
              ) : (
                heroImageSource
              )}
              . The hero image is <strong>not</strong> covered by the above
              license. All rights belong to the original author.
            </p>
          )
        }
        <p class="meta-text">
          <span>
            Published:
            {pubDate.toLocaleDateString()}
          </span>
          {
            updatedDate && (
              <>
                <span>
                  Updated:
                  {updatedDate.toLocaleDateString()}
                </span>
              </>
            )
          }
        </p>
        {
          tags && (
            <p class="mini-tag-container">
              tags:
              {tags.map((tag) => (
                <a href={`/tag/${tag}`}>{tag}</a>
              ))}
            </p>
          )
        }
        <p class="description">
          {description}
        </p>
      </div>
      <hr />
      <slot />
    </article>
  </Card>
</RootLayout>

<style lang="scss">
  @use "@/styles/colors";

  hr {
    border: none;
    background-color: var(--color-muted-foreground);
    margin-block: 0;
    height: 0.5px;
    margin: 1rem 0;
  }

  .meta {
    & > * {
      margin-block: 0;
    }

    .meta-text {
      display: flex;
      gap: 1rem;
      font-size: 0.8rem;
    }

    .mini-tag-container {
      gap: 0.5rem;
      display: flex;
      flex-wrap: wrap;
    }

    .description {
      font-size: 1rem;
    }
  }

  .hero-image {
    border-radius: 1rem;
    overflow: hidden;
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 21/9;
  }
</style>
